"use strict";(()=>{var e=class extends HTMLElement{decision_threshold=null;isAnimating=!1;$actualCard=null;startX=0;startY=0;pullDeltaX=0;pullDeltaY=0;constructor(){super(),this.startDrag=this.startDrag.bind(this),this.onMove=this.onMove.bind(this),this.onEnd=this.onEnd.bind(this),this.start()}start(){this.decision_threshold=Number(this.dataset.threshold??75),this.addEventListener("mousedown",this.startDrag),this.addEventListener("touchstart",this.startDrag,{passive:!1})}startDrag(t){t.stopPropagation(),t.preventDefault(),!this.isAnimating&&(this.$actualCard=this.lastElementChild,this.$actualCard&&(this.setCoords(t),this.addListeners()))}setCoords(t){this.startX=this.getCoord(t,"X"),this.startY=this.getCoord(t,"Y")}getCoord(t,s){return typeof TouchEvent<"u"&&t instanceof TouchEvent?t.touches[0][`page${s}`]:t[`page${s}`]}addListeners(){document.addEventListener("mousemove",this.onMove),document.addEventListener("mouseup",this.onEnd),document.addEventListener("touchmove",this.onMove,{passive:!1}),document.addEventListener("touchend",this.onEnd,{passive:!0})}onMove(t){if(this.pullDeltaX=this.getCoord(t,"X")-this.startX,this.pullDeltaY=this.getCoord(t,"Y")-this.startY,this.pullDeltaX===0&&this.pullDeltaY===0)return;this.isAnimating=!0;let s=this.pullDeltaX/14;this.$actualCard&&(this.$actualCard.classList.add("dragged"),this.$actualCard.classList.toggle("to-left",this.pullDeltaX<=0),this.$actualCard.classList.toggle("to-right",this.pullDeltaX>=0),this.$actualCard.classList.toggle("to-top",this.pullDeltaY<=0),this.$actualCard.classList.toggle("to-bottom",this.pullDeltaY>=0),this.$actualCard.style.transform=`translateX(${this.pullDeltaX}px) translateY(${this.pullDeltaY}px) rotate(${s}deg)`,this.$actualCard.style.cursor="grabbing")}onEnd(){this.removeListeners(),this.$actualCard.classList.remove("dragged");let t=Math.abs(this.pullDeltaX)>=this.decision_threshold||Math.abs(this.pullDeltaY)>=this.decision_threshold;this.$actualCard&&(t?this.applyCardDecision():this.resetCardPosition(),this.endCardAnimation())}removeListeners(){document.removeEventListener("mousemove",this.onMove),document.removeEventListener("mouseup",this.onEnd),document.removeEventListener("touchmove",this.onMove),document.removeEventListener("touchend",this.onEnd)}applyCardDecision(){let t=this.pullDeltaX>=0,s=this.pullDeltaY>=0;this.$actualCard.classList.add(t?"go-right":"go-left",s?"go-down":"go-up"),this.dispatchEvent(new CustomEvent("discard",{bubbles:!0,detail:{goRight:t,goDown:s,card:this.$actualCard}})),this.$actualCard.addEventListener("transitionend",()=>{this.$actualCard?.remove()})}resetCardPosition(){this.$actualCard.classList.add("reset"),this.$actualCard.classList.remove("go-right","go-left","go-down","go-up","to-left","to-right","to-top","to-bottom")}endCardAnimation(){this.$actualCard.addEventListener("transitionend",()=>{this.$actualCard?.removeAttribute("style"),this.$actualCard?.classList.remove("reset"),this.pullDeltaX=0,this.pullDeltaY=0,this.isAnimating=!1})}};customElements.define("card-deck",e);})();
